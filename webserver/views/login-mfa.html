{{##def.page_title = 'Login' #}}

{{##def.content:
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<div class="container mx-auto px-4 py-12 max-w-xl">
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 shadow-2xl p-8">
        <header class="border-b border-slate-700 pb-5 mb-6 text-center">
            <h1 class="text-3xl font-bold text-white">Two-Factor Authentication</h1>
            <p class="text-slate-400 mt-2">Confirm your identity to finish signing in.</p>
        </header>

        <form action="/login" method="post" onsubmit="return submitEnabled;" class="space-y-6">
            <input type="hidden" name="username" value="{{!it.username}}" />
            <input type="hidden" name="password" value="{{!it.password}}" />

            <div class="space-y-2">
                <label for="otp" class="block text-sm font-semibold text-slate-300">
                    2FA token
                </label>
                <input
                    id="otp"
                    type="text"
                    pattern="[0-9]{6}"
                    inputmode="numeric"
                    name="otp"
                    required
                    class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition"
                    placeholder="Enter the 6-digit code"
                />
                <p class="text-xs text-slate-500">Use the current code from your authenticator application.</p>
            </div>

            <div class="flex flex-col items-center gap-4">
                <div class="g-recaptcha" data-sitekey="{{=it.recaptchaKey}}" data-callback="enableSubmit"></div>
                <p id="captcha-hint" class="text-sm text-slate-400 text-center">Complete the reCAPTCHA to enable the submit button.</p>
            </div>

            <button
                id="loginSubmit"
                type="submit"
                disabled
                class="hidden w-full px-6 py-4 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 rounded-lg font-semibold text-lg text-white shadow-lg hover:shadow-xl transform hover:scale-[1.01] transition"
            >
                Verify &amp; Log In
            </button>
        </form>
    </div>
</div>

<script>
    let submitEnabled = false;

    function enableSubmit() {
        submitEnabled = true;
        const submitButton = document.getElementById('loginSubmit');
        if (submitButton) {
            submitButton.disabled = false;
            submitButton.classList.remove('hidden');
        }
        const hint = document.getElementById('captcha-hint');
        if (hint) {
            hint.textContent = 'You can now submit the form.';
            hint.classList.remove('text-slate-400');
            hint.classList.add('text-green-400');
        }
    }
</script>

#}}
{{#def.include('./template/main_new')}}