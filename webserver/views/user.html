{{##def.page_title = 'User Stats' #}}

{{##def.content:
    <div class="container mx-auto px-4 py-10 max-w-5xl">
        <div class="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 shadow-2xl p-8 space-y-10">
            <header class="border-b border-slate-700 pb-6">
                <p class="text-sm uppercase tracking-wide text-slate-400">Player overview</p>
                <h1 class="text-3xl font-bold text-white flex items-center gap-2">
                    {{?it.user && it.stats.username == it.user.username}}
                        <a href="/account" class="text-white hover:text-cyan-300 transition">{{=it.stats.username }}</a>
                        <span class="text-xs font-semibold text-emerald-400 bg-emerald-400/10 px-2 py-1 rounded-full uppercase tracking-wide">You</span>
                    {{??}}
                        {{=it.stats.username}}
                    {{?}}
                </h1>
            </header>

            <section class="grid grid-cols-1 md:grid-cols-4 gap-5">
                <div class="bg-slate-900/60 border border-slate-700 rounded-xl p-5 shadow-lg">
                    <p class="text-sm font-medium text-slate-400">Games played</p>
                    <p class="mt-2 text-3xl font-bold text-white">{{=it.stats.games_played}}</p>
                </div>
                <a href="/leaderboard" class="block bg-slate-900/60 border border-slate-700 rounded-xl p-5 shadow-lg hover:border-cyan-500 hover:shadow-cyan-500/20 transition">
                    <p class="text-sm font-medium text-slate-400">Rank</p>
                    <p class="mt-2 text-3xl font-bold text-white">{{=it.stats.rank}}</p>
                    <p class="mt-2 text-xs text-cyan-300">View full leaderboard</p>
                </a>
                <div class="bg-slate-900/60 border border-slate-700 rounded-xl p-5 shadow-lg">
                    <p class="flex items-center gap-2 text-sm font-medium text-slate-400">
                        Gross profit
                        <a href="/faq#gross-profit" class="text-xs text-cyan-300 hover:text-cyan-200 transition">Learn more</a>
                    </p>
                    <p class="mt-2 text-3xl font-bold text-emerald-400">{{#def.format: { n: it.stats.gross_profit, decimals: 2} }}<span class="ml-1 text-base font-semibold text-emerald-200">bits</span></p>
                </div>
                <div class="bg-slate-900/60 border border-slate-700 rounded-xl p-5 shadow-lg">
                    <p class="text-sm font-medium text-slate-400">Net profit</p>
                    <p class="mt-2 text-3xl font-bold text-emerald-400">{{#def.format: { n: it.stats.net_profit, decimals: 2} }}<span class="ml-1 text-base font-semibold text-emerald-200">bits</span></p>
                </div>
            </section>

            <section class="space-y-4">
                {{? it.showing_last}}
                    <h2 class="text-xl font-semibold text-white">Showing game {{= it.games_from}} to {{= it.games_to}}</h2>
                {{??}}
                    <h2 class="text-xl font-semibold text-white">Showing last {{= it.games_to - it.games_from + 1}} games</h2>
                {{?}}

                <div class="bg-slate-900/60 border border-slate-700 rounded-xl p-4">
                    <div id="chartdiv" class="w-full h-[400px]"></div>
                </div>
            </section>

            <nav class="flex flex-wrap items-center justify-between gap-3">
                <div class="flex gap-2">
                    {{? it.previous_page }}
                        <a href="?p=1" class="px-4 py-2 rounded-lg border border-slate-700 text-sm font-medium text-slate-300 hover:border-cyan-500 hover:text-white transition">First</a>
                        <a href="{{= it.previous_page }}" class="px-4 py-2 rounded-lg border border-slate-700 text-sm font-medium text-slate-300 hover:border-cyan-500 hover:text-white transition">Previous</a>
                    {{?}}
                </div>
                <div class="flex gap-2 ml-auto">
                    {{? it.next_page }}
                        <a href="{{= it.next_page }}" class="px-4 py-2 rounded-lg border border-slate-700 text-sm font-medium text-slate-300 hover:border-cyan-500 hover:text-white transition">Next</a>
                        <a href="{{= it.stats.username }}" class="px-4 py-2 rounded-lg border border-slate-700 text-sm font-medium text-slate-300 hover:border-cyan-500 hover:text-white transition">Last</a>
                    {{?}}
                </div>
            </nav>

            <div class="text-xs text-slate-500">
                Chart powered by AmCharts.
            </div>

            <script src="/vendor/amcharts/amcharts.js" type="text/javascript"></script>
            <script src="/vendor/amcharts/serial.js" type="text/javascript"></script>
            <script src="/vendor/amcharts/custom.js" type="text/javascript"></script>
            <script>
                CustomChart({{= it.games_from}}, {{= it.net_profit_offset}}, {{=JSON.stringify(it.plays)}});
            </script>
        </div>
    </div>
#}}
{{#def.include('./template/main_new')}}