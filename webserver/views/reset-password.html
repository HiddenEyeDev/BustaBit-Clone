{{##def.page_title = 'Reset Password' #}}

{{##def.content:
<div class="container mx-auto px-4 py-12 max-w-2xl">
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 shadow-2xl p-8">
        <header class="border-b border-slate-700 pb-5 mb-6">
            <h1 class="text-3xl font-bold text-white">Reset password</h1>
            <p class="text-slate-400 mt-2">
                Choose a strong password for <span class="font-semibold text-white">{{=it.user.username}}</span>. Your password must be at least 7 characters long.
            </p>
        </header>

        <form action="/sent-reset" method="post" class="space-y-6">
            <div class="space-y-2">
                <label for="password" class="block text-sm font-semibold text-slate-300">New password</label>
                <input
                    type="password"
                    autocomplete="new-password"
                    pattern=".{7,200}"
                    id="password"
                    name="password"
                    required
                    class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition"
                    placeholder="Enter a new password"
                />
                <p class="text-xs text-slate-500">Minimum of 7 characters. Avoid using a password you use elsewhere.</p>
            </div>

            <div class="space-y-2">
                <label for="confirmation" class="block text-sm font-semibold text-slate-300">Confirm password</label>
                <input
                    type="password"
                    autocomplete="new-password"
                    pattern=".{7,200}"
                    id="confirmation"
                    name="confirmation"
                    required
                    class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition"
                    placeholder="Repeat the new password"
                />
            </div>

            {{?it.user.mfa_secret}}
            <div class="space-y-2">
                <label for="otp" class="block text-sm font-semibold text-slate-300">2FA code</label>
                <input
                    type="text"
                    autocomplete="one-time-code"
                    pattern="[0-9]{6}"
                    inputmode="numeric"
                    id="otp"
                    name="otp"
                    required
                    class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition"
                    placeholder="Enter the 6-digit code"
                />
            </div>
            {{?}}

            <input name="recover_id" type="hidden" value="{{!it.recoverId}}"/>

            <div class="flex items-center justify-between">
                <a href="/login" class="text-sm font-medium text-slate-400 hover:text-cyan-300 transition">Back to login</a>
                <button
                    type="submit"
                    class="px-6 py-3 bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 rounded-lg font-semibold text-white shadow-lg hover:shadow-xl transition"
                >
                    Reset password
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function validatePassword() {
        const password = document.getElementById('password');
        const confirmation = document.getElementById('confirmation');
        if (!password || !confirmation) {
            return;
        }
        if (password.value !== confirmation.value) {
            confirmation.setCustomValidity('Confirmation and password should be the same');
        } else {
            confirmation.setCustomValidity('');
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const password = document.getElementById('password');
        const confirmation = document.getElementById('confirmation');
        if (password && confirmation) {
            password.addEventListener('input', validatePassword);
            confirmation.addEventListener('input', validatePassword);
        }
    });
</script>

#}}
{{#def.include('./template/main_new')}}